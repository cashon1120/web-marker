{"version":3,"file":"bundle.js","sources":["../src/utils.js","../src/index.js","../src/createBtnDom.js"],"sourcesContent":["export const setDomDisplay = (dom, value) => {\n  dom.style.display = value\n}\n\nexport const setuuid = () => {\n  return new Date().getTime()\n}\n\nexport const setTextSelected = (text, id, color, bgColor) => {\n  return `<span class=\"web_marker_selected\" id=\"${id}\" style=\"color: ${color}; background-color: ${bgColor}\">${text}</span>`\n}\n\nexport const getUserAgent = () => {\n  const u = navigator.userAgent\n  const isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1\n  const isiOS = !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/)\n  const eventName = {\n    mousedown: isAndroid || isiOS ? 'touchstart' : 'mousedown',\n    mouseup: isAndroid || isiOS ? 'touchend' : 'mouseup',\n    mousemove: isAndroid || isiOS ? 'touchmove' : 'mousemove',\n  }\n  return {\n    isAndroid,\n    isiOS,\n    eventName\n  }\n}\n\nexport const setDomMap = (dom, arr = []) => {\n  if (dom.parentNode) {\n    for (let i = 0; i < dom.parentNode.childNodes.length; i++) {\n      if (dom.parentNode.childNodes[i] === dom) {\n        arr.push(i)\n        if (dom.parentNode !== document.body) {\n          setDomMap(dom.parentNode, arr)\n        }\n      }\n    }\n  }\n  return arr\n}\n\nexport const getDom = (deeps, childIndex) => {\n  let dom = document.body\n  deeps.forEach(domIndex => {\n    for (let i = 0; i < dom.childNodes.length; i++) {\n      if (i === domIndex) {\n        dom = dom.childNodes[i]\n      }\n    }\n  })\n  return dom.childNodes[childIndex]\n}","import {setDomDisplay, setuuid, setTextSelected, getUserAgent, setDomMap, getDom} from './utils'\nimport createBtnDom from './createBtnDom.js'\n\n/**\n * @param options 包含如下参数\n * @param defaultMarkers: 初始标记数据\n * @param markedStyles: 标记文本样式\n * @param btnStyles: 操作框样式\n * @param onSave: 标记后回调, 必填\n*/\n\nclass textMarker {\n  constructor(options) {\n\n    if(!options || !options.onSave) {\n      throw new Error('options中的 onSave 选项为必填')\n    }\n\n    if(typeof options.onSave !== 'function') {\n      throw new Error('onSave 必须为一个函数')\n    }\n\n    // 标记样式\n    this.markedStyles = {\n      color: '#fff',\n      backgroundColor: 'cadetblue',\n      ...options.markedStyles\n    }\n\n    this.onSave = options.onSave\n\n    // 所有标记文本, 最后转换成json字符串保存到数据库\n    this.selectedMarkers = []\n\n    // 当前操作dom, 目前只能是一个\n    this.selectedDom = null\n\n    // 选中文本对象, 从 window.getSelection() 中拿\n    this.selectedText = {}\n\n    // 当前选中的节点, 多个节点不处理\n    this.currentSelectedDom = []\n\n    // 操作框显示位置\n    this.pageY = 0\n\n    // 临时保存标记信息, 鼠标抬起时设置, 解决点击\"标记\"按钮时 window.getSelection 影响 this.selectedText 的问题\n    this.tempMarkerInfo = {}\n\n    // 要删除的标记 id\n    this.deleteId = ''\n\n    // 获取浏览器环境\n    this.userAgent = getUserAgent()\n\n    // 当数据库有标记数据时, 设置标记状态\n    if (Array.isArray(options.defaultMarkers) && options.defaultMarkers.length > 0) {\n      this.setDefaultMarkers(options.defaultMarkers)\n    }\n\n    // 创建按钮节点\n    createBtnDom(this, options.btnStyles)\n    // 监听事件\n    document.addEventListener('selectionchange', this.handleSelectionChange.bind(this))\n\n    document.addEventListener(this.userAgent.eventName.mousedown, (e) => {\n      const target = e.target\n      // 当选中的文本已经标记时的处理, 隐藏 \"标记\" 按钮, 显示 \"删除\" 按钮\n      if (target.className === 'selected_text') {\n        this.pageY = e.pageY\n        setDomDisplay(this.btn_mark, 'none')\n        setDomDisplay(this.btn_delete, 'block')\n        this.deleteId = e.target.id\n        this.show()\n        return\n      }\n      this.currentSelectedDom = []\n      this.selectedDom = target\n      this.currentSelectedDom.push(target)\n      document.addEventListener(this.userAgent.eventName.mousemove, this.handleMouseMove.bind(this))\n      document.addEventListener(this.userAgent.eventName.mouseup, this.handleMouseUp.bind(this))\n    })\n\n  }\n\n  // 选中文本事件\n  handleSelectionChange() {\n    if (window.getSelection()) {\n      this.selectedText = window.getSelection()\n    } else {\n      return\n    }\n  }\n\n  // 鼠标移动事件\n  handleMouseMove(e) {\n    if (!this.currentSelectedDom.includes(e.target)) {\n      this.currentSelectedDom.push(e.target)\n    }\n  }\n\n  // 鼠标抬起事件\n  handleMouseUp(e){\n    document.removeEventListener(this.userAgent.eventName.mousemove, this.handleMouseMove)\n    document.removeEventListener(this.userAgent.eventName.mouseup, this.handleMouseUp)\n\n    if (this.selectedText.toString().length === 0 || !this.selectedText.getRangeAt){\n      this.hide()\n      return\n    }\n   \n    // 遇到以下节点时不处理, 可按需要添加\n    const igonreDomElement = ['BUTTON', 'H1', 'H2', 'IMG']\n    if (igonreDomElement.includes(this.selectedText.getRangeAt(0).commonAncestorContainer.parentNode.nodeName)) {\n      return\n    }\n\n    // 选中多个节点时不处理\n    if (this.currentSelectedDom.length > 1) {\n      return\n    }\n\n    setDomDisplay(this.btn_mark, 'block')\n    setDomDisplay(this.btn_delete, 'none')\n\n\n    const {\n      anchorOffset,\n      focusOffset\n    } = this.selectedText\n\n    this.pageY = e.pageY\n    let childIndex = 0\n    for (let i = 0; i < this.selectedDom.childNodes.length; i++) {\n      if (this.selectedDom.childNodes[i] === this.selectedText.anchorNode) {\n        childIndex = i\n      }\n    }\n    const deeps = setDomMap(this.selectedDom, [])\n    this.tempMarkerInfo = {\n      id: setuuid(),\n      domDeeps: deeps.reverse(),\n      childIndex,\n      startIndex: Math.min(anchorOffset, focusOffset),\n      endIndex: Math.max(anchorOffset, focusOffset)\n    }\n    this.show()\n\n  }\n\n  hide(){\n    setDomDisplay(this.btn_Box, 'none')\n  }\n\n  show(){\n    setDomDisplay(this.btn_Box, 'flex')\n    this.btn_Box.style.top = this.pageY + 20 + 'px'\n  }\n\n  mark(e){\n    e.preventDefault()\n    e.stopPropagation()\n    const text = this.selectedText.toString()\n    const rang = this.selectedText.getRangeAt(0)\n    var span = document.createElement('span')\n    span.className = 'selected_text'\n    span.id = this.tempMarkerInfo.id\n    span.style.color = this.markedStyles.color\n    span.style.backgroundColor = this.markedStyles.backgroundColor\n    span.innerHTML = text\n    rang.surroundContents(span);\n    this.selectedMarkers.push(this.tempMarkerInfo)\n    this.selectedText.removeAllRanges()\n    this.hide()\n    this.save()\n  }\n\n  save() {\n    const markersJson = JSON.stringify(this.selectedMarkers)\n    const userAgent = getUserAgent()\n    if (userAgent.isAndroid) {\n      // window.jsObject...\n    }\n\n    if (userAgent.isiOS) {\n      // window.webkit.jsObject.callBack.postMessage(this.selectedMarkers)\n    }\n\n    if(this.onSave){\n      this.onSave(markersJson)\n    }\n  }\n\n  del(){\n    this.selectedMarkers.forEach((marker, index) => {\n      const dom = document.getElementById(this.deleteId)\n      const parentNode = dom.parentNode\n\n      if (marker.id.toString() === this.deleteId) {\n        const text = dom.innerText\n        const replaceTextNode = document.createTextNode(text)\n        parentNode.replaceChild(replaceTextNode, dom)\n\n        // 当删除parentNode节点的前面的标记时, 修正后面标记相关参数\n        // 删除一个标记, 需要把前后的两个节点(如果为文本节点的话)合并为一个节点\n\n        const {domDeeps, childIndex, endIndex } = marker\n        const preDom = replaceTextNode.previousSibling\n        const nextDom = replaceTextNode.nextSibling\n        if(preDom.nodeType === 3){\n          preDom.textContent = preDom.textContent + text\n          parentNode.removeChild(replaceTextNode)\n          if(nextDom.nodeType === 3){\n            preDom.textContent = preDom.textContent + nextDom.textContent\n            parentNode.removeChild(nextDom)\n          }\n        }else{\n          if(nextDom.nodeType === 3){\n            replaceTextNode.textContent = replaceTextNode.textContent + nextDom.textContent\n            parentNode.removeChild(nextDom)\n          }\n        }\n\n\n        this.selectedMarkers.forEach(item => {\n          if(JSON.stringify(item.domDeeps) === JSON.stringify(domDeeps) && item.childIndex > childIndex){\n            item.childIndex = item.childIndex - 2\n            item.startIndex = item.startIndex + endIndex\n            item.endIndex = item.endIndex + endIndex\n          }\n        })\n\n        this.selectedMarkers.splice(index, 1)\n        this.save()\n      }\n    })\n  }\n\n  setDefaultMarkers(defaultMarkers){\n    this.selectedMarkers = defaultMarkers\n    defaultMarkers.forEach(marker => {\n      const textNode = getDom(marker.domDeeps, marker.childIndex)\n      if(!textNode) return\n      const html = textNode.textContent\n      const startHtml = html.substr(0, marker.startIndex)\n      const replaceHtml = html.substr(marker.startIndex, marker.endIndex - marker.startIndex)\n      const endHtml = html.substr(marker.endIndex)\n      textNode.textContent =\n        `${startHtml}${setTextSelected(replaceHtml, marker.id, this.markedStyles.color, this.markedStyles.backgroundColor)}${endHtml}`\n      const parentNode = textNode.parentNode\n      let parentHtml = parentNode.innerHTML\n      parentHtml = parentHtml.replace(/&lt;/g, '<').replace(/&gt;/g, '>')\n      parentNode.innerHTML = parentHtml\n    })\n  }\n}\n\nwindow.webMarker = textMarker\n","import {getUserAgent} from './utils'\n\n\nconst createBtnDom = (textMarker, styles) => {\n    const defaultStyles = {\n      position: 'fixed',\n      textAlign: 'center',\n      width: '80%',\n      left: '10%',\n      height: '35px',\n      lineHeight: '35px',\n      backgroundColor: 'black',\n      borderRadius: 3,\n      display: 'none',\n      color: '#fff',\n      ...styles\n    }\n    const btnBox = document.createElement('div')\n\n    btnBox.id = 'webMarkerBtnBox'\n    Object.keys(defaultStyles).forEach(key => {\n      btnBox.style[key] = defaultStyles[key]\n    })\n\n    btnBox.innerHTML = `\n      <div style=\"flex: 1\" id=\"webMarker_btn_mark\">标记</div>\n      <div style=\"flex: 1\" id=\"webMarker_btn_delete\">删除当前标记</div>\n      <div style=\"flex: 1\" id=\"webMarker_btn_cancel\">取消</div>\n    `\n    document.body.appendChild(btnBox)\n    textMarker.btn_Box = document.getElementById('webMarkerBtnBox')\n    textMarker.btn_mark = document.getElementById('webMarker_btn_mark')\n    textMarker.btn_cancel = document.getElementById('webMarker_btn_cancel')\n    textMarker.btn_delete = document.getElementById('webMarker_btn_delete')\n\n    textMarker.btn_mark.addEventListener(getUserAgent().eventName.mousedown, textMarker.mark.bind(textMarker))\n    textMarker.btn_cancel.addEventListener('click', textMarker.hide.bind(textMarker))\n    textMarker.btn_delete.addEventListener('click', textMarker.del.bind(textMarker))\n  \n  }\n\n  export default createBtnDom"],"names":["setDomDisplay","dom","value","style","display","getUserAgent","u","navigator","userAgent","isAndroid","indexOf","isiOS","match","eventName","mousedown","mouseup","mousemove","setDomMap","arr","parentNode","i","childNodes","length","push","document","body","window","webMarker","[object Object]","options","onSave","Error","this","markedStyles","color","backgroundColor","selectedMarkers","selectedDom","selectedText","currentSelectedDom","pageY","tempMarkerInfo","deleteId","Array","isArray","defaultMarkers","setDefaultMarkers","textMarker","styles","defaultStyles","position","textAlign","width","left","height","lineHeight","borderRadius","btnBox","createElement","id","Object","keys","forEach","key","innerHTML","appendChild","btn_Box","getElementById","btn_mark","btn_cancel","btn_delete","addEventListener","mark","bind","hide","del","createBtnDom","btnStyles","handleSelectionChange","e","target","className","show","handleMouseMove","handleMouseUp","getSelection","includes","removeEventListener","toString","getRangeAt","commonAncestorContainer","nodeName","anchorOffset","focusOffset","childIndex","anchorNode","deeps","Date","getTime","domDeeps","reverse","startIndex","Math","min","endIndex","max","top","preventDefault","stopPropagation","text","rang","span","surroundContents","removeAllRanges","save","markersJson","JSON","stringify","marker","index","innerText","replaceTextNode","createTextNode","replaceChild","preDom","previousSibling","nextDom","nextSibling","nodeType","textContent","removeChild","item","splice","textNode","domIndex","getDom","html","startHtml","substr","replaceHtml","endHtml","bgColor","parentHtml","replace"],"mappings":"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"}